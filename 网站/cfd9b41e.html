<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0"><link rel="apple-touch-icon" sizes="180x180" href="/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon.ico"><link rel="mask-icon" href="/images/logo.svg" color="#222"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"moeyui1.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!0,mediumzoom:!1,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!1,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}}}</script><meta name="description" content="本站最近搬运到国内主机，并尝试启用了cdn加速，最后为了启用https放弃了cdn加速，关于这点破事儿的小记录。"><meta property="og:type" content="article"><meta property="og:title" content="本站最近的一点小动作"><meta property="og:url" content="http://moeyui1.github.io/%E7%BD%91%E7%AB%99/cfd9b41e.html"><meta property="og:site_name" content="不是很懂"><meta property="og:description" content="本站最近搬运到国内主机，并尝试启用了cdn加速，最后为了启用https放弃了cdn加速，关于这点破事儿的小记录。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://7xsf5m.com1.z0.glb.clouddn.com/%E6%9C%AC%E7%AB%99%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%8F%E5%8A%A8%E4%BD%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E5%AE%8C%E5%85%A8https.png"><meta property="og:image" content="http://7xsf5m.com1.z0.glb.clouddn.com/%E6%9C%AC%E7%AB%99%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%8F%E5%8A%A8%E4%BD%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E4%B8%8D%E5%AE%8C%E5%85%A8https.png"><meta property="article:published_time" content="2016-08-24T13:43:17.000Z"><meta property="article:modified_time" content="2021-02-08T10:12:18.759Z"><meta property="article:author" content="moeyui"><meta property="article:tag" content="网络"><meta property="article:tag" content="cdn"><meta property="article:tag" content="https"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://7xsf5m.com1.z0.glb.clouddn.com/%E6%9C%AC%E7%AB%99%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%8F%E5%8A%A8%E4%BD%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E5%AE%8C%E5%85%A8https.png"><link rel="canonical" href="http://moeyui1.github.io/%E7%BD%91%E7%AB%99/cfd9b41e.html"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>本站最近的一点小动作 | 不是很懂</title><script>function sendPageView(){if(CONFIG.hostname===location.hostname){var e=localStorage.getItem("uid")||Math.random()+"."+Math.random();localStorage.setItem("uid",e),navigator.sendBeacon("https://www.google-analytics.com/collect",new URLSearchParams({v:1,tid:"UA-75483578-1",cid:e,t:"pageview",dp:encodeURIComponent(location.pathname)}))}}document.addEventListener("pjax:complete",sendPageView),sendPageView()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script>function loadCss(e){var n=document,s=n.head,t=n.createElement("link");t.rel="stylesheet",t.href=e,function e(s){if(n.body)return s();setTimeout(function(){e(s)})}(function(){s.appendChild(t)})}loadCss("/style.css"),loadCss("//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"),loadCss("//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css")</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css"></noscript></head><body itemscope="" itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope="" itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">不是很懂</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">不是很懂你们程序员</p></div><div class="site-nav-right"><div class="toggle popup-trigger"></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i> 首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i> 归档</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i> 关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i> 标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i> 分类</a></li></ul></nav></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div> <a href="https://github.com/moeyui1" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://moeyui1.github.io/%E7%BD%91%E7%AB%99/cfd9b41e.html"><span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/blogAvatar.jpg"><meta itemprop="name" content="moeyui"><meta itemprop="description" content="moeyui | moeyui's blog"></span><span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization"><meta itemprop="name" content="不是很懂"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"> 本站最近的一点小动作</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i></span> <span class="post-meta-item-text">发表于</span> <time title="创建时间：2016-08-24 21:43:17" itemprop="dateCreated datePublished" datetime="2016-08-24T21:43:17+08:00">2016-08-24</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i></span> <span class="post-meta-item-text">更新于</span> <time title="修改时间：2021-02-08 18:12:18" itemprop="dateModified" datetime="2021-02-08T18:12:18+08:00">2021-02-08</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i></span> <span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/%E7%BD%91%E7%AB%99/" itemprop="url" rel="index"><span itemprop="name">网站</span></a></span></span><span id="/%E7%BD%91%E7%AB%99/cfd9b41e.html" class="post-meta-item leancloud_visitors" data-flag-title="本站最近的一点小动作" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i></span> <span class="post-meta-item-text">阅读次数：</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-comment"></i></span> <span class="post-meta-item-text">Valine：</span><a title="valine" href="/%E7%BD%91%E7%AB%99/cfd9b41e.html#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/%E7%BD%91%E7%AB%99/cfd9b41e.html" itemprop="commentCount"></span></a></span><div class="post-description">本站最近搬运到国内主机，并尝试启用了cdn加速，最后为了启用https放弃了cdn加速，关于这点破事儿的小记录。</div></div></header><div class="post-body" itemprop="articleBody"><h2 id="1-搬运至国内主机"><a href="#1-搬运至国内主机" class="headerlink" title="1. 搬运至国内主机"></a>1. 搬运至国内主机</h2><p>本博原是部署在github上，然而美国机房延迟实在感人。再来手上有一台腾讯云的学生机，干脆就部署过来吧。</p><p>由于本博实质为静态网站，所以直接将文件部署到nginx下就好。主机用的是<a target="_blank" rel="noopener" href="http://lnmp.org/download.html">lnmp</a>所以步骤也很简单：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lnmp vhost add moeyui.cn 	#添加网站</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure><p>然后在<code>/home/wwwroot/</code>目录下会生成一个名为<code>moeyui.cn</code>的文件夹，接下来把静态文件全部搬过来就好了。然而相比直接拷贝，我们不如利用git来帮我们实时同步。通过<code>git clone</code>命令将文件clone到文件夹下，为了与github上的文件时刻保持同步，我们可以编辑crontab来添加定时任务。如果还没有安装crontab，centos可以<code>yum install -y vixie-cron</code>来安装，其它系统请自行百度。输入<code>crontab -e</code>编辑任务计划，添加以下语句：</p><figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * * cd /home/wwwroot/moeyui.cn/moeyui1.github.io&amp;&amp;git pull</span><br></pre></td></tr></tbody></table></figure><p>这样就可以保证博客实时同步了。</p><h2 id="2-cdn加速"><a href="#2-cdn加速" class="headerlink" title="2. cdn加速"></a>2. cdn加速</h2><p>后来才发现改善国内访问速度其实可以使用国内的cdn服务，国内免费且不用备案的cdn吾辈推荐<a target="_blank" rel="noopener" href="http://su.baidu.com/">百度云加速</a>，国外推荐<a target="_blank" rel="noopener" href="https://www.cloudflare.com/">cloudfare</a>。</p><p>百度云加速提供了两种cdn加速方式——NS和CNAME。</p><p>NS方式实际上就是改用百度的dns服务，让百度直接调度，而CNAME方式相对较传统，通过将对域名的访问指向百度的服务器来让百度调度。</p><h2 id="3-启用https"><a href="#3-启用https" class="headerlink" title="3. 启用https"></a>3. 启用https</h2><p>于是乎，心血来潮又想搞一波https，反正免费证书满大街是吧，浏览器地址栏绿色的https多有B格ヾ(o◕∀◕)ﾉヾ。于是乎申请了<strong><a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s encrypt</a></strong>的免费证书。</p><p>安装证书的方式有很多，官方给了一个<a target="_blank" rel="noopener" href="https://letsencrypt.org/docs/client-options/">很长的列表</a>。官方推荐使用<a target="_blank" rel="noopener" href="https://certbot.eff.org/">certbot</a>，环境要求python2.7，然而腾讯云上的centos6.7自带的是python2.6。。。重点是自带源里面最新就是2.6，而且手动编译安装2.7之后会出现莫名其妙的问题——yum都用不了（<em>具体原因吾辈也不清楚</em>）。</p><p>所以只好找其它办法，这里推荐一个<a target="_blank" rel="noopener" href="https://github.com/xdtianyu/scripts/tree/master/lets-encrypt">脚本获取证书的方式</a>，简单快捷。作者的<a target="_blank" rel="noopener" href="https://github.com/xdtianyu/scripts/blob/master/lets-encrypt/README-CN.md">readme</a>写得很清楚，这里就不再细说。</p><h3 id="在nginx上配置"><a href="#在nginx上配置" class="headerlink" title="在nginx上配置"></a>在nginx上配置</h3><p><strong>需要提醒的是</strong>，脚本需要先通过文件路径在网站文件夹下存放一个文件，再通过根据网站地址从网络上把那个文件下载下来校验。在nginx上配置时，记得检查网站的配置文件，如果有以下这句话：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~  /\.</span><br><span class="line">        {</span><br><span class="line">            deny all;</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure><p>可能会访问不到校验文件，需要在这段话前面加上一段：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location ~ /.well-known/acme-challenge/</span><br><span class="line">        {</span><br><span class="line">                expires 12h;</span><br><span class="line">        }</span><br></pre></td></tr></tbody></table></figure><h3 id="和cdn的冲突"><a href="#和cdn的冲突" class="headerlink" title="和cdn的冲突"></a>和cdn的冲突</h3><p>cdn缓存页面是不会使用上一步生成的证书的，所以不能支持https访问。并且百度云加速不能上传自定义的证书，使用百度云的https服务又必须付费，故不得不从cdn和https中选其一。</p><p>国外的cloudflare可以免费提供证书cdn，然而其国内速度感人。。。</p><h3 id="全站https"><a href="#全站https" class="headerlink" title="全站https"></a>全站https</h3><p>虽然启用了https，但本站并不是全站https，当你打开首页可以看到浏览器地址栏是这样的：</p><p><img data-src="http://7xsf5m.com1.z0.glb.clouddn.com/%E6%9C%AC%E7%AB%99%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%8F%E5%8A%A8%E4%BD%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E5%AE%8C%E5%85%A8https.png" alt="完全https"></p><p>但随便点进一篇带图片的文章，就变成了这样：</p><p><img data-src="http://7xsf5m.com1.z0.glb.clouddn.com/%E6%9C%AC%E7%AB%99%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E7%82%B9%E5%B0%8F%E5%8A%A8%E4%BD%9C/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E4%B8%8D%E5%AE%8C%E5%85%A8https.png" alt="不完全https"></p><p>这是因为本站图片外链是http，所以全站只能算不完全https。七牛自定义外链域名需要付费。</p></div><footer class="post-footer"><div class="post-tags"> <a href="/tags/%E7%BD%91%E7%BB%9C/" rel="tag"># 网络</a> <a href="/tags/cdn/" rel="tag"># cdn</a> <a href="/tags/https/" rel="tag"># https</a></div><div class="post-nav"><div class="post-nav-item"><a href="/coding/297d577b.html" rel="prev" title="小记JAVAFX-Maven-Html项目路径引用"><i class="fa fa-chevron-left"></i> 小记JAVAFX-Maven-Html项目路径引用</a></div><div class="post-nav-item"> <a href="/uncategorized/35b1ad9c.html" rel="next" title="scrapy中css和xpath选择的一些坑">scrapy中css和xpath选择的一些坑<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc"> 文章目录</li><li class="sidebar-nav-overview"> 站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E6%90%AC%E8%BF%90%E8%87%B3%E5%9B%BD%E5%86%85%E4%B8%BB%E6%9C%BA"><span class="nav-number">1.</span> <span class="nav-text">1. 搬运至国内主机</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-cdn%E5%8A%A0%E9%80%9F"><span class="nav-number">2.</span> <span class="nav-text">2. cdn加速</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E5%90%AF%E7%94%A8https"><span class="nav-number">3.</span> <span class="nav-text">3. 启用https</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8nginx%E4%B8%8A%E9%85%8D%E7%BD%AE"><span class="nav-number">3.1.</span> <span class="nav-text">在nginx上配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%92%8Ccdn%E7%9A%84%E5%86%B2%E7%AA%81"><span class="nav-number">3.2.</span> <span class="nav-text">和cdn的冲突</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E7%AB%99https"><span class="nav-number">3.3.</span> <span class="nav-text">全站https</span></a></li></ol></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person"> <img class="site-author-image" itemprop="image" alt="moeyui" src="/images/blogAvatar.jpg"><p class="site-author-name" itemprop="name">moeyui</p><div class="site-description" itemprop="description">moeyui | moeyui's blog</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"> <a href="/archives/"><span class="site-state-item-count">40</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"> <a href="/categories/"><span class="site-state-item-count">7</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"> <a href="/tags/"><span class="site-state-item-count">37</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/moeyui1" title="GitHub → https://github.com/moeyui1" rel="noopener" target="_blank"><i class="github fa-fw"></i> GitHub</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright"> © 2015 – <span itemprop="copyrightYear">2021</span><span class="with-love"><i class="fa-user"></i></span> <span class="author" itemprop="copyrightHolder">moeyui</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> &amp; <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动</div></div></footer></div><script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/bundle.js"></script><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  };(function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();;NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'Nk9tNzbllEl79DVtRiOuLmbm-gzGzoHsz',
      appKey     : 'uPzxSfSzF95Gav6vGx2dOhCq',
      placeholder: "Just go go",
      avatar     : 'retro',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});</script></body></html>